<html>
<head>
	<title>EmberCustomCtls</title>
	<script src="libs/jquery-1.9.1.min.js"></script>
	<script src="libs/jquery.validate.min.js"></script>
	<script src="libs/handlebars.js"></script>
	<script src="libs/ember-1.0.0-rc.1.js"></script>
	<script src="libs/ember-data.js"></script>
</head>
<body>
	<h4>Custom Controls</h4>
	<i>demonstrates just how lame custom controls (views) are in Ember</i>
	
	<script type="text/x-handlebars" data-template-name="application">
		<form id="mainform">
			{{#each user in controller}}
				{{ view App.UserEditView contentBinding="user" }}
			{{/each}}
		</form>
	</script>	
	
	<script type="text/x-handlebars" data-template-name="useredit-control">
		{{ view Ember.TextField valueBinding="user.firstName" name="firstName" }}
		{{ view Ember.TextField valueBinding="user.lastName" name="lastName" }}
		{{ view Ember.TextField valueBinding="user.email" name="email" }}
		{{ view Practice.EditLevelSelect valueBinding="user.editLevel" }}
		{{ view Ember.Checkbox checkedBinding="user.isAdmin" name="isAdmin" }}
		<button {{ action "delete" }}>X</button>
		{{ controller }}
	</script>	
</body>
<script>

var App = Em.Application.create({});

App.Router.map(function(){
	this.resource('employees', { path:'/' });
})

App.ApplicationRoute = Em.Route.extend({
	model: function(){
		return App.User.find();
	}
});

App.ApplicationController = Em.ArrayController.extend({
});	

App.UserEditRoute = Em.Route.extend({
	model: function(){
		console.log("in UserEditRoute....");
		return App.User.createRecord();
	}
});

App.UserEditController = Em.ObjectController.extend({
	init: function(){
		console.log("initializing UserEditController...");
	},
	userTitle: function() {
		return "Dr";
	}.property(),
	delete: function(model){
		alert('in UserEditController delete.');
	}
});

App.UserEditView = Em.View.extend({
	controller: App.UserEditController,
	templateName: 'useredit-control',
	didInsertElement: function() {
		console.log('in view didInsertElement...');
		var frm = $('#mainform');
		frm.validate({
			rules: {
				firstName: { required: true },
				lastName: { required: true }
			}
		});
	},
	//click: function(event) { alert('hai from view'); }
	delete: function(model){
		alert('in UserEditController delete.');
	}

});

App.TextFieldNew = Ember.TextField.extend({
	attributeBindings: [ 'name', 'data-validation-group' ]
});

App.Store = DS.Store.extend({
	adapter: 'DS.FixtureAdapter',
	revision: 11
});

App.User = DS.Model.extend({
	firstName: DS.attr('string'),
	lastName: DS.attr('string'),
	email: DS.attr('string'),
	isAdmin: DS.attr('boolean'),
	editLevel: DS.attr('number')
});

App.User.FIXTURES = [
	{
		id:1,
		firstName: 'Marcy',
		lastName:'Darcy',
		email:'testing@testing.com',
		isAdmin:false,
		editLevel:1
	},
	{
		id:2,
		firstName: 'Fred',
		lastName:'Fredrickson',
		email:'ff@ff.org',
		isAdmin:true,
		editLevel:2
	},
	{
		id:3,
		firstName: 'Mary',
		lastName:'Smith',
		email:'mary_smith@smithandsons.com',
		isAdmin:false,
		editLevel:3
	},
	{
		id:4,
		firstName: 'Kevin',
		lastName:'Kevinson',
		email:'kevink@theprovidersgroup.org',
		isAdmin:false,
		editLevel:1
	}

];


var Practice = {};
Practice.CustomControls = {};

//******************************************************
// Quick timezone select list
// Example Use (from template)
// {{ view Practice.EditLevelSelect valueBinding="editLevel" id="EditLevel" name="EditLevel" }}
//******************************************************
Practice.EditLevelSelect = Ember.Select.extend({
    attributeBindings: [ 'name', 'data-validation-group' ],
    contentBinding: "Practice.CustomControls.editLevelController",
    selectionBinding: "Practice.CustomControls.selectedEditLevelController.editLevel",
    optionLabelPath: "content.name",
    optionValuePath: "content.code"
});

Practice.CustomControls.EditLevel = Ember.Object.extend({
    id: null,
    code: null,
    name: null
});

Practice.CustomControls.selectedEditLevelController = Ember.Object.create({
    editLevel: null
});

// TODO: get this from a table or fill in the remaining countries
Practice.CustomControls.editLevelController = Ember.ArrayController.create({
    content: [
        Practice.CustomControls.EditLevel.create({id: 1, code: '1', name: 'Provider'}),
        Practice.CustomControls.EditLevel.create({id: 2, code: '2', name: 'Nurse'}),
        Practice.CustomControls.EditLevel.create({id: 3, code: '3', name: 'Staff'})
    ]
});
</script>

</html>

